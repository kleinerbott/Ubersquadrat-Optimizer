<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Ãœbersquadrat Optimizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Optimize geographical square exploration with route planning">
  <meta name="theme-color" content="#00cc00">

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div id="map"></div>
  <div id="sidebar">
    <h3>Ãœbersquadrat Optimizer</h3>
    <label>KML-Datei:</label>
    <button id="loadKmlBtn" style="width:100%;margin-bottom:5px;">ğŸ“‚ KML-Datei laden</button>
    <small id="currentKmlStatus" style="display:block;margin-bottom:10px;color:#666;font-style:italic;">Keine Datei geladen</small>
    <hr>
    <label>Neue Quadrate: <span id="numAddValue">5</span></label>
    <input id="numAdd" type="range" value="5" min="1" max="20">
    <label>Richtung:</label>
    <div class="direction-buttons">
      <button type="button" id="directionBtnN" class="direction-btn" data-direction="N">N</button>
      <button type="button" id="directionBtnS" class="direction-btn" data-direction="S">S</button>
      <button type="button" id="directionBtnE" class="direction-btn" data-direction="E">E</button>
      <button type="button" id="directionBtnW" class="direction-btn" data-direction="W">W</button>
      <button type="button" id="directionBtnAll" class="direction-btn all-btn selected">Alle</button>
    </div>
    <hr>
    <label>Optimierungsmodus:</label>
    <select id="optimizationMode">
      <option value="balanced">Ausgewogen</option>
      <option value="edge">Kantenabschluss</option>
      <option value="holes">LÃ¶cher fÃ¼llen</option>
    </select>
    <label>Max. LochgrÃ¶ÃŸe: <span id="maxHoleSizeValue">3</span></label>
    <input id="maxHoleSize" type="range" value="3" min="1" max="10">
    <small style="display:block;margin-bottom:10px;color:#666;">(LÃ¶cher Ã¼ber dieser GrÃ¶ÃŸe werden ignoriert)</small>
    <button id="optimizeBtn">Optimieren</button>
    <hr>
    <h4 style="margin-top:10px;margin-bottom:10px;">Routing</h4>
    <hr>
    <label>Bike-Typ:</label>
    <select id="bikeType">
      <option value="trekking">Standard</option>
      <option value="gravel">Gravel</option>
      <option value="fastbike">Rennrad</option>
    </select>
    <label style="display:flex;align-items:center;margin-top:10px;">
      <input type="checkbox" id="roundtrip" style="margin-right:5px;">
      <span>Rundreise (Start = Ziel)</span>
    </label>
    <button id="selectStartBtn" style="margin-top:10px;">ğŸ“ Startpunkt wÃ¤hlen</button>
    <small id="startPointStatus" style="display:block;margin-top:5px;color:#666;font-style:italic;">Kein Startpunkt gewÃ¤hlt</small>
    <button id="calculateRouteBtn" style="margin-top:10px;background-color: rgb(23, 99, 29);" disabled>Route berechnen</button>
    <div id="routeStats" style="margin-top:10px;padding:8px;background:#f0f0f0;border-radius:4px;display:none;">
      <div><strong>Route:</strong> <span id="routeDistance">--</span> km</div>
      <div><strong>HÃ¶he:</strong> â†— <span id="routeElevation">--</span> m</div>
      <div><strong>Zeit:</strong> â± <span id="routeTime">--:--</span></div>
    </div>
    <div id="routeExport" style="margin-top:10px;display:none;">
      <button id="exportGpxBtn" style="width:48%;margin-right:4%;">ğŸ’¾ GPX</button>
      <button id="exportKmlBtn" style="width:48%;">ğŸ’¾ KML</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
  <script>
    // Update slider value displays
    const numAddSlider = document.getElementById('numAdd');
    const numAddValue = document.getElementById('numAddValue');
    numAddSlider.addEventListener('input', (e) => {
      numAddValue.textContent = e.target.value;
    });

    const maxHoleSizeSlider = document.getElementById('maxHoleSize');
    const maxHoleSizeValue = document.getElementById('maxHoleSizeValue');
    maxHoleSizeSlider.addEventListener('input', (e) => {
      maxHoleSizeValue.textContent = e.target.value;
    });
  </script>

  <!-- Register Service Worker for PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Only register if served over http/https (not file://)
        if (window.location.protocol !== 'file:') {
          navigator.serviceWorker.register('/service-worker.js')
            .then(reg => console.log('Service Worker registered:', reg.scope))
            .catch(err => console.warn('Service Worker registration failed:', err));
        } else {
          console.info('Service Worker disabled (file:// protocol). Use a web server for PWA features.');
        }
      });
    }
  </script>

  <script type="module" src="js/map.js"></script>
</body>
</html>
